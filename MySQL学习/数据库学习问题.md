# 数据库学习遇到的问题 #

1. 加锁问题,隐式锁什么时候解除
2. 在增删改时会加上什么类型的锁

1. 长事务为什么会导致回滚段快速增大?

2. MDL锁:元数据锁

	当对数据进行增删改查便会获取该表的MDL的读锁
	要对表的结构进行修改,此时会获得MDL写锁
	读锁之间不互斥,但是读写锁直接互斥,所以可以多个客户端同时进行增删改,但是不能在增删改的同时修改表的结构

注意:如果一个客户端获取MDL锁时阻塞了,后面对于DML锁的请求都会被阻塞

如何避免由于获取MDL锁被阻塞而导致的数据库线程在短时间被充满?

某个对数据表结构的更改,导致获取DML锁被阻塞,后面某个请求对该表数据的读取将会被阻塞,如果此时客户端存在重传机制,将会在短时间内将数据库的线程的充满


3. 更新时加锁

	在对数据更新时,会对这条被更新的记录加上锁,直到更新数据的事务提交才释放该锁


解决可能出现的死锁的问题

	- 等待时间达到设置的时间,直到超时
	- 发起死锁检测

		死锁检测的原理是构建一个以事务为点、锁为边的有向图，判断有向图是否存在环，存在即有死锁

- 如果解决由于对热点行的更新而导致的死锁问题?

	- 降低并发度,一般不可行
	- 修改MySQL源码,对行的更新顺序进行排序
	- 将热点行用多行存储起来,这样对同一行的更新频率自然降低下来


加锁:

select语句加锁之后也是当前读,updata获取的锁也是当前读

		
可以使用show processlist 命令，看看当前语句处于什么状态。